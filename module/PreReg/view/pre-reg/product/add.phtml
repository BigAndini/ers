<?php

$this->headTitle($product->getName());
?>
<a href="<?php echo $this->url($breadcrumb->route, $breadcrumb->params, $breadcrumb->options);?>"><?php echo $this->translate('back to Overview'); ?></a>
<h1><?php echo $this->escapeHtml($product->getName()); ?></h1>

<?php if($chooser): ?>
<div class="p_overlay">
    <div class="p_overlay_inner">
        <p class="p_overlay_close">
            <span class="p_overlay_close_inner">
                <a href="<?php echo $this->url($bc_stay->route, $bc_stay->params, $bc_stay->options);?>">X</a>
            </span>
        </p>
        <h3>
            Added <span class="green"><?php echo $product->getName(); ?></span> to your shopping cart.
        </h3>
        <div class="floatLeft">
            <a class="btn btn-default" href="<?php echo $this->url('product'); ?>">&lt; products</a>
        </div>
        <div class="floatRight">
            <a class="btn btn-primary" href="<?php echo $this->url('order'); ?>">shopping cart &gt;</a>
        </div>
        <div class="clear-both"></div>
    </div>
</div>
<?php endif; ?>

<?php
if(count($product->getProductPrices()) == 0):
?>
<p class="desc-short">This product is unavailable</p>
<?php
else:
?>
<p class="desc-short"><?php echo $product->getShortDescription(); ?></p>
<div class="product-view">
    <div class="row">
        <div class="col-lg-3">
            <img src="/img/no-available-image.png" alt="No available image" width="200">
        </div>
        <div class="col-lg-5">
            <?php echo $product->getLongDescription(); ?>
        </div>
    </div>
    <?php
    $form = $this->form;
    $form->prepare();

    echo $this->form()->openTag($form); ?>
    <div class="row">
        <div class="col-lg-5">
            <?php if($product->getPersonalized() || count($participants) > 0) {
                echo $this->formRow($form->get('participant_id'));
            ?>
            <a href="<?php echo $this->url('participant', array('action' => 'add')); ?>">add person to this list</a>
            <?php
                if($form->get('submit')->getAttribute('disabled') == 'disabled'):
                ?>
                    <div class="alert alert-warning">
                        <h4>Please choose a person</h4>
                        <p>This is a personalized ticket. You have to enter the person who will use the ticket for the event.</p>
                        <div class="clear-both"></div>
                    </div>
                <?php
                endif;
            }
            $form->get('Product_id')->setAttribute('value', $product->getId());
            echo $this->formHidden($form->get('Product_id'));
            $prices = $product->getProductPrices();

            for($i = 0; $i<$form->getVariantCounter(); $i++) {
                echo $this->formHidden($form->get('variant_id_'.$i));
                echo $this->formRow($form->get('variant_value_'.$i));
                echo $this->formRow($form->get('variant_type_'.$i));
            }
            ?>
        </div>
        <div class="col-lg-7">
            <?php if($agegroup == null):
                error_log('agegroup is null :(');
            endif; ?>
            <table class='table table-notbordered price-table'>
                <?php foreach($agegroups as $ag): ?>
                <?php $class = '';
                if($agegroup != null && $agegroup->getId() == $ag->getId()):
                    $class = 'product-price-active';
                endif; ?>
                <tr>
                    <td>
                        <span class="product-price<?php echo ' '.$class ?>"><?php echo $ag->getName(); ?></span>
                    </td>
                    <td>
                        <span class="product-price<?php echo ' '.$class ?>"><?php echo $this->currencyFormat($product->getProductPrice($ag, $deadline)->getCharge(), 'EUR', null, 'de_DE'); ?></span>
                    </td>
                </tr>
                <?php endforeach; ?>
                <?php $class = '';
                if($participant->getSessionId() == 0 || $agegroup == null):
                    $class = 'product-price-active';
                endif; ?>
                <tr>
                    <td></td>
                    <td>
                        <span class="product-price<?php echo ' '.$class ?>"><?php echo $this->currencyFormat($product->getProductPrice(null, $deadline)->getCharge(), 'EUR', null, 'de_DE'); ?></span>
                    </td>
                </tr>
                
            </table>
        </div>
    </div>
    <div class="row text-right">
        <div class="col-sm-12">
            <?php echo $this->formSubmit($form->get('submit')); ?>
        </div>
    </div>
    <?php
    echo $this->form()->closeTag();
    ?>
</div>
<?php endif; ?>